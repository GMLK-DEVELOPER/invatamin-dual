# Админ-панель на Flask с MySQL

Современная административная панель на Flask с аутентификацией и базой данных MySQL.

## Особенности

- Современный и отзывчивый дизайн с использованием Bootstrap
- Аутентификация и авторизация пользователей
- Управление пользователями
- Управление блогом (посты, категории, комментарии)
- Управление страницами
- Статистика и аналитика
- Работа с MySQL
- Автоматическое создание и использование виртуальной среды Python

## Требования

- Python 3.7+
- MySQL Server
- Pip (Python Package Manager)

## Установка

### Windows

1. Установите [Python](https://www.python.org/downloads/)
2. Установите [MySQL Server](https://dev.mysql.com/downloads/mysql/)
3. Клонируйте или скачайте репозиторий
4. Запустите `setup_admin.bat` для автоматической настройки с использованием миграций или `setup_direct.bat` для настройки без миграций

Скрипты автоматически:
- Создадут виртуальную среду Python (папка `venv`)
- Активируют виртуальную среду
- Установят все необходимые зависимости
- Настроят базу данных MySQL
- Создадут таблицы и начального пользователя

### Linux/Mac

1. Установите Python и MySQL сервер
```bash
# Для Ubuntu/Debian
sudo apt-get update
sudo apt-get install python3 python3-pip mysql-server

# Для Mac с Homebrew
brew install python mysql
```

2. Клонируйте или скачайте репозиторий
3. Сделайте скрипты исполняемыми:
```bash
chmod +x setup.sh run.sh
```

4. Запустите скрипт установки:
```bash
./setup.sh
```

Скрипт автоматически:
- Создаст виртуальную среду Python 
- Активирует виртуальную среду
- Установит все необходимые зависимости
- Настроит базу данных MySQL
- Предложит выбрать способ создания таблиц (миграции или напрямую)
- Создаст таблицы и начального пользователя

Вы также можете выполнить этапы установки вручную:
```bash
# Создание и активация виртуальной среды
python3 -m venv venv
source venv/bin/activate

# Установка зависимостей
pip install -r requirements.txt

# Настройка базы данных
python init_db.py

# Создание таблиц через миграции
flask --app app db init
flask --app app db migrate -m "Initial migration"
flask --app app db upgrade
# ИЛИ напрямую
python create_tables.py
```

## Запуск приложения

### Windows
Запустите `run.bat`, который автоматически активирует виртуальную среду (если она существует) и запустит приложение.

### Linux/Mac
Запустите скрипт `run.sh`, который автоматически активирует виртуальную среду (если она существует) и запустит приложение:
```bash
./run.sh
```

Или запустите вручную:
```bash
# Активируйте виртуальную среду, если она еще не активирована
source venv/bin/activate

# Запустите приложение
python app.py
```

Перейдите в браузере по адресу: http://localhost:5000/admin/login

## Учетные данные по умолчанию

- Логин: qwe
- Пароль: qwe

## Устранение проблем

### Проблемы с миграциями

Если у вас возникают проблемы с миграциями Flask-Migrate, попробуйте использовать прямое создание таблиц:

```bash
python create_tables.py
```

Или запустите скрипт `setup_direct.bat`, который настроит базу данных без использования миграций.

### Ошибка AttributeError: 'Flask' object has no attribute 'before_first_request'

Эта ошибка возникает в новых версиях Flask (2.3+), где был удален декоратор `before_first_request`. В нашем коде эта проблема уже исправлена с использованием контекста приложения.

### Проблемы с подключением к MySQL

Если у вас возникают проблемы при подключении к MySQL, убедитесь, что:
- MySQL сервер запущен
- Пользователь имеет права доступа к базе данных
- Вы указали правильный пароль и имя пользователя

Для устранения проблем попробуйте подключиться к MySQL напрямую:
```bash
mysql -u username -p
```

## Структура базы данных

### Таблица users
- id: Первичный ключ
- username: Имя пользователя
- password: Хешированный пароль
- name: Полное имя
- email: Email адрес
- role: Роль пользователя
- last_login: Время последнего входа
- created_at: Время создания
- updated_at: Время обновления

### Таблица posts
- id: Первичный ключ
- title: Заголовок поста
- slug: URL-совместимый slug
- content: Содержимое поста
- excerpt: Краткое описание
- featured_image: Путь к изображению
- status: Статус (draft, published, etc.)
- category_id: Внешний ключ для категории
- author_id: Внешний ключ для автора
- created_at: Время создания
- updated_at: Время обновления

### Таблица categories
- id: Первичный ключ
- name: Название категории
- slug: URL-совместимый slug
- description: Описание категории
- created_at: Время создания
- updated_at: Время обновления

### Таблица comments
- id: Первичный ключ
- content: Содержимое комментария
- author_name: Имя автора
- author_email: Email автора
- status: Статус комментария
- post_id: Внешний ключ для поста
- created_at: Время создания

### Таблица pages
- id: Первичный ключ
- title: Заголовок страницы
- slug: URL-совместимый slug
- content: Содержимое страницы
- status: Статус страницы
- featured_image: Путь к изображению
- author_id: Внешний ключ для автора
- created_at: Время создания
- updated_at: Время обновления

## Настройка и конфигурация

Конфигурация приложения хранится в файле `app.py`. Вы можете изменить следующие параметры:

- Секретный ключ: `app.secret_key`
- База данных: `app.config['SQLALCHEMY_DATABASE_URI']`

## Лицензия

MIT 